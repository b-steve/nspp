context("Testing simulation")

test_that(
    "Correct values simulated",
    {
        set.seed(1234)
        points.2D <- sim.ns(pars = c(D = 10, sigma = 0.025, child.par = 10))
        expect_equal(c(points.2D),
                     c(0.581196270600658, 0.623837357309605, 0.607203966399184, 0.632770331978152, 
                       0.623504615438917, 0.641478843195418, 0.623664320711233, 0.640336227262238, 
                       0.580141229071072, 0.636958764069785, 0.627443586513718, 0.642948878620521, 
                       0.586494438287857, 0.859153629092558, 0.892752999633897, 0.89241822893542, 
                       0.832945547443097, 0.812630422047547, 0.865011679412862, 0.849618675175491, 
                       0.816748902835145, 0.611161908584543, 0.625676857014711, 0.674772896798691, 
                       0.625995735135499, 0.628509373943989, 0.635457990807674, 0.64649835927009, 
                       0.062880321636254, 0.017625263684444, 0.014339413905181, 0.0354350137533987, 
                       0.0850238623011122, 0.0142797282482595, 0.241331666730697, 0.221225779036168, 
                       0.227948532711541, 0.236380983269343, 0.222567630288136, 0.182296363346753, 
                       0.248832680137037, 0.262333961322734, 0.248077940352197, 0.234329165900266, 
                       0.248045249354264, 0.287228485045205, 0.683585763910133, 0.679247594253499, 
                       0.619565849445548, 0.666055332109686, 0.665735235671637, 0.687815341891707, 
                       0.653489994918177, 0.64877853024371, 0.664643721504226, 0.686850851702292, 
                       0.651478745344889, 0.598129836519705, 0.618900076150787, 0.63414520598046, 
                       0.498565236136558, 0.53188222795528, 0.535955663175651, 0.522007695519285, 
                       0.513310384770086, 0.501832669767567, 0.514497639989833, 0.539990217072191, 
                       0.459142438979723, 0.514786821205754, 0.545294997694983, 0.515454159067163, 
                       0.525145198901815, 0.696371205103245, 0.681256701163733, 0.725690658877875, 
                       0.694317286810475, 0.709838641963923, 0.672923152538051, 0.665427039128768, 
                       0.661661747797409, 0.578975267241002, 0.565762873395196, 0.584347439990595, 
                       0.545178825370567, 0.553543096285069, 0.542954322244549, 0.573035367212086, 
                       0.281566007007531, 0.286886461576037, 0.264146924595882, 0.339296659880444, 
                       0.286199200771142, 0.26383534836663, 0.887037062118811, 0.928754317594675, 
                       0.941020349151586, 0.910540255771746, 0.887635478276715, 0.931891714778449, 
                       0.984262272324928, 0.946494554710505, 0.932341821353153, 0.94172854930002, 
                       0.917369491596271, 0.908890298020602, 0.329620254742918, 0.318260142774044, 
                       0.281651484252441, 0.281809715442453, 0.2965317638529, 0.272349093636887, 
                       0.350205798139073, 0.304649601998489, 0.296999976653512, 0.298431281905133, 
                       0.296285495841948, 0.293572890194552, 0.276875858723488, 0.238680957371793
                       ))
        ## Testing simulation plotting.
        expect_is(sim.ns(pars = c(D = 10, sigma = 0.025, child.par = 10), plot.points = TRUE),
                  "matrix")
        ## Testing empirical Palm intensity plotting.
        expect_is(sim.ns(pars = c(D = 100, sigma = 0.025, child.par = 10),
                         lims = rbind(c(0, 1), c(0, 1), c(0, 1)), plot.empirical = TRUE),
                  "matrix")
        ## Testing generic rchild.dist.
        rchild <- function(n, x) rnbinom(n, 2.5, mu = x)
        points.nb <- sim.ns(pars = c(D = 100, sigma = 0.025, child.par = 10),
                            lims = rbind(c(0, 1), c(0, 1), c(0, 1), c(0, 1)))
        expect_equal(ncol(points.nb), 4)
        expect_equal(head(c(points.nb)), c(0.801714027135933, 0.795248781767784,
                                           0.777107548567544, 0.792765042052449, 
                                           0.814804465315765, 0.771518947138259))
    })
